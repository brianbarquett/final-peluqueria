<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Configuración básica del documento HTML -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro e Inicio de Sesión</title>
    <!-- Enlace al archivo CSS externo para estilos -->
    <link rel="stylesheet" href="/css/registro.css">
</head>
<body>
    <!-- Barra de navegación superior -->
    <div class="navbar">
        <a href="#" onclick="goBack()">◀ Volver al Inicio</a>
    </div>
    <!-- Contenedor principal para los paneles de logo y formulario -->
    <div class="container" id="mainContainer">
        <!-- Panel para el logo y nombre de la barbería -->
        <div class="panel" id="logoPanel">
            <img src="/php/uploads/logo_barber1.png" alt="Gold Style Logo" style="filter: brightness(0) invert(1);">
            <h1>Gold Style</h1>
        </div>
        <!-- Panel para los formularios de registro e inicio de sesión -->
        <div class="panel" id="formPanel">
            <!-- Sección del formulario de registro -->
            <div id="signupFormDiv" class="form-div">
                <h2>Registro de Usuario</h2>
                <form id="signupForm" action="../php/procesar_registro.php" method="POST" onsubmit="return validateSignup(event)">
                    <input type="text" name="nombre" placeholder="Nombre completo" id="fullName" required>
                    <input type="text" name="dni" placeholder="DNI" id="dni" required>
                    <input type="number" name="edad" placeholder="Edad" id="age" required min="1" max="120">
                    <input type="tel" name="telefono" placeholder="Teléfono" id="phone" required>
                    <input type="password" name="contrasena" placeholder="Contraseña" id="password" required>
                    <input type="email" name="correo" placeholder="Correo electrónico" id="email" required>
                    <button type="submit">Registrarse</button>
                    <button type="button" onclick="showLoginPanel()">Iniciar Sesión</button>
                </form>
            </div>
            <!-- Sección del formulario de inicio de sesión (oculta inicialmente) -->
            <div id="loginFormDiv" class="form-div" style="display: none;">
                <h2>Iniciar Sesión</h2>
                <form id="loginForm" action="../php/procesar_login.php" method="POST" onsubmit="return validateLogin(event)">
                    <input type="text" name="dni" placeholder="DNI" id="loginDni" required>
                    <input type="password" name="contrasena" placeholder="Contraseña" id="loginPassword" required>
                    <button type="submit">Ingresar</button>
                    <button type="button" onclick="showSignupPanel()">Registrarse</button>
                </form>
                <p onclick="showResetForm()" style="cursor: pointer; text-decoration: underline;">¿Olvidaste tu contraseña?</p>
                <!-- Formulario de recuperación (oculto inicialmente) -->
                <div id="resetFormDiv" style="display: none;">
                    <h2>Recuperar Contraseña</h2>
                    <form id="resetForm" action="../php/procesar_recuperacion.php" method="POST" onsubmit="return validateReset(event)">
                        <input type="email" name="correo" placeholder="Correo electrónico" id="resetEmail" required>
                        <button type="submit">Enviar Link de Recuperación</button>
                        <button type="button" onclick="hideResetForm()">Cancelar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal para mostrar errores -->
    <div class="error-modal" id="errorModal">
        <h3>Error</h3>
        <p id="errorMessage">Por favor, completa todos los campos correctamente.</p>
        <button onclick="hideError()">Cerrar</button>
    </div>
    <!-- Modal para mostrar éxito -->
    <div class="success-modal" id="successModal">
        <h3>¡Éxito!</h3>
        <p id="successMessage">El usuario se registró con éxito.</p>
        <button onclick="hideSuccess()">Cerrar</button>
    </div>

    <script>
        // Evento que se ejecuta al cargar la página para manejar parámetros de URL
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const mode = params.get('mode');
            const success = params.get('success');
            const error = params.get('error');

            if (mode === 'login') {
                showLoginPanel();
            }

            if (success === '1') {
                showSuccess('El usuario se registró con éxito.');
                showLoginPanel(); // Redirige automáticamente al panel de login
            } else if (success === 'reset_sent') {
                showSuccess('Se envió un link de recuperación a tu correo.');
                showLoginPanel();
            }

            if (error === '1') {
                showError('DNI o contraseña incorrectos.');
            } else if (error === 'duplicate') {
                showError('El correo o DNI ya está registrado.');
            } else if (error === 'validation') {
                showError('Por favor, revisa los campos del formulario.');
            } else if (error === 'server') {
                showError('Error en el servidor. Intenta nuevamente.');
            }
        });

        // Función para volver al inicio
        function goBack() {
            window.location.href = "../php/index_cliente.php";
        }
        // Función para mostrar el modal de error con un mensaje
        function showError(message) {
            const modal = document.getElementById('errorModal');
            document.getElementById('errorMessage').textContent = message || 'Por favor, completa todos los campos correctamente.';
            modal.style.display = 'block';
        }
        // Función para ocultar el modal de error
        function hideError() {
            document.getElementById('errorModal').style.display = 'none';
        }
        // Función para mostrar el modal de éxito con un mensaje
        function showSuccess(message) {
            const modal = document.getElementById('successModal');
            document.getElementById('successMessage').textContent = message || 'El usuario se registró con éxito.';
            modal.style.display = 'block';
        }
        // Función para ocultar el modal de éxito
        function hideSuccess() {
            document.getElementById('successModal').style.display = 'none';
        }
        // Función para mostrar el panel de inicio de sesión y animar el cambio
        function showLoginPanel() {
            const logoPanel = document.getElementById('logoPanel');
            const formPanel = document.getElementById('formPanel');
            const signupFormDiv = document.getElementById('signupFormDiv');
            const loginFormDiv = document.getElementById('loginFormDiv');
            signupFormDiv.style.display = 'none';
            loginFormDiv.style.display = 'flex';
            logoPanel.style.left = '50%';
            formPanel.style.left = '0%';
            logoPanel.style.background = '#ad930f';
            formPanel.style.background = '#000000';
            document.body.style.background = 'linear-gradient(to right, #ad930f, #000000)';
        }
        // Función para mostrar el panel de registro y animar el cambio
        function showSignupPanel() {
            const logoPanel = document.getElementById('logoPanel');
            const formPanel = document.getElementById('formPanel');
            const signupFormDiv = document.getElementById('signupFormDiv');
            const loginFormDiv = document.getElementById('loginFormDiv');
            loginFormDiv.style.display = 'none';
            signupFormDiv.style.display = 'flex';
            logoPanel.style.left = '0%';
            formPanel.style.left = '50%';
            logoPanel.style.background = '#000000';
            formPanel.style.background = '#ad930f';
            document.body.style.background = 'linear-gradient(to right, #000000, #ad930f)';
        }
        // Función de validación del formulario de registro antes de enviar
        function validateSignup(event) {
            const fullName = document.getElementById('fullName').value.trim();
            const dni = document.getElementById('dni').value.trim();
            const age = parseInt(document.getElementById('age').value);
            const phone = document.getElementById('phone').value.trim();
            const password = document.getElementById('password').value;
            const email = document.getElementById('email').value.trim();

            if (!fullName || !dni || isNaN(age) || !phone || !password || !email) {
                showError('Todos los campos son obligatorios.');
                return false;
            }
            if (age < 1 || age > 120) {
                showError('La edad debe estar entre 1 y 120 años.');
                return false;
            }
            if (!/^\d{8,10}$/.test(phone)) {
                showError('El teléfono debe tener entre 8 y 10 dígitos.');
                return false;
            }
            if (password.length < 6) {
                showError('La contraseña debe tener al menos 6 caracteres.');
                return false;
            }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showError('El correo electrónico no es válido.');
                return false;
            }
            if (!/^\d{8}$/.test(dni)) {
                showError('El DNI debe tener exactamente 8 dígitos.');
                return false;
            }

            return true;
        }
        // Función de validación del formulario de inicio de sesión antes de enviar
        function validateLogin(event) {
            const dni = document.getElementById('loginDni').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!dni || !password) {
                showError('Por favor, ingresa DNI y contraseña.');
                return false;
            }
            if (!/^\d{8}$/.test(dni)) {
                showError('El DNI debe tener 8 dígitos.');
                return false;
            }
            if (password.length < 6) {
                showError('La contraseña debe tener al menos 6 caracteres.');
                return false;
            }

            return true;
        }
        // Función para mostrar el formulario de reset
        function showResetForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('resetFormDiv').style.display = 'flex';
        }
        // Función para ocultar el formulario de reset y volver al login
        function hideResetForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('resetFormDiv').style.display = 'none';
        }
        // Validación para el form de reset
        function validateReset(event) {
            const email = document.getElementById('resetEmail').value.trim();
            if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showError('El correo electrónico no es válido.');
                return false;
            }
            return true;
        }
    </script>
</body>
</html>